// scripts/bulkUploadTemplates.js - ëŒ€ëŸ‰ í…œí”Œë¦¿ ìë™ ì—…ë¡œë“œ
const fs = require('fs');
const path = require('path');
const axios = require('axios');

// ë§¤í•‘ ë°ì´í„°
const TEMPLATE_MAPPING = {
  'OEM ê¸°ë³¸ê³„ì•½ì„œ': 'ì œì¡°/ê³µê¸‰',
  'PFV ìì‚°ê´€ë¦¬ìœ„íƒê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'TVí™ˆì‡¼í•‘ê±°ë˜í‘œì¤€ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ê°œë°œìš©ì—­ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ê°œì¸ì •ë³´ ìˆ˜ì§‘í™œìš© ë™ì˜ì„œ': 'ë¹„ë°€/ë³´ì•ˆ',
  'ê°œì¸ì •ë³´ì²˜ë¦¬ìœ„íƒ ê³„ì•½ì„œ': 'ë¹„ë°€/ë³´ì•ˆ',
  'ê±´ë¬¼ì² ê±°ìš©ì—­ í‘œì¤€ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ê±´ì„¤ê³µì‚¬í‘œì¤€í•˜ë„ê¸‰ê³„ì•½ì„œ': 'ì œì¡°/ê³µê¸‰',
  'ê±´ì¶•ë¬¼ ê³µì‚¬ê°ë¦¬ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ê±´ì¶•ì„¤ê³„ì—…ì¢… í‘œì¤€í•˜ë„ê¸‰ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ê²€ìˆ˜í™•ì¸ì„œ ìƒ˜í”Œ(ì„¤ì¹˜ì¥ë¹„ ê²€ì‚¬ì‚¬í•­ ë° ê²€ì‚¬ë°©ë²•)': 'ê¸°íƒ€/ì¼ë°˜',
  'ê²€ìˆ˜í™•ì¸ì„œ(ìƒì„¸)': 'ê¸°íƒ€/ì¼ë°˜',
  'ê²€ìˆ˜í™•ì¸ì„œ(ì¼ë°˜ì–‘ì‹)': 'ê¸°íƒ€/ì¼ë°˜',
  'ê²Œì„(ë„ê¸‰) í‘œì¤€ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ê³ ë¬¸ìœ„ì´‰ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ê³µì‚¬ëŒ€ê¸ˆ ì§€ë¶ˆê°ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ê³µì‚¬ì™„ë£Œí™•ì¸ì„œ': 'ê¸°íƒ€/ì¼ë°˜',
  'ê³µì—°ì˜ˆìˆ  ê¸°ìˆ ì§€ì› í‘œì¤€ê·¼ë¡œê³„ì•½ì„œ': 'ê·¼ë¡œ/ê³ ìš©',
  'ê³µì—°ì˜ˆìˆ  í‘œì¤€ëŒ€ê´€ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ê³µì—°ì˜ˆìˆ ê¸°ìˆ ì§€ì› í‘œì¤€ìš©ì—­ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ê³µì—°ì˜ˆìˆ ì°½ì‘ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ê³µì—°ì˜ˆìˆ ì¶œì—°ê³„ì•½ì„œ': 'ê·¼ë¡œ/ê³ ìš©',
  'ê´‘ê³ ë¬¼ì œì‘ê³„ì•½ì„œêµ­ë¬¸': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ê´‘ê³ ìš©ê±´ë¬¼ì„ëŒ€ê³„ì•½ì„œì•½ì‹': 'ê±°ë˜/êµ¬ë§¤',
  'ê·¸ë¦¼ ë“± ë§¤ë§¤ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ê·¸ë¦¼ ì‚¬ì§„ ì €ì‘ë¬¼ íŒë§¤ìœ„íƒê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ê¸ˆì „ì†Œë¹„ëŒ€ì°¨ ê³„ì•½ì„œ': 'íˆ¬ì/ìê¸ˆ',
  'ê¸ˆí˜•ì œì‘ì—…ì¢… í‘œì¤€í•˜ë„ê¸‰ê³„ì•½ì„œ': 'ì œì¡°/ê³µê¸‰',
  'ê¸°ê³„ì—…ì¢… ì œì¡° í‘œì¤€í•˜ë„ê¸‰ê³„ì•½ì„œ': 'ì œì¡°/ê³µê¸‰',
  'ë‚©í’ˆê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ë…¸ë¬´ì œê³µ ê³µí†µ í‘œì¤€ê³„ì•½ì„œ(ê³ ìš©ë…¸ë™ë¶€)': 'ê·¼ë¡œ/ê³ ìš©',
  'ëŒ€ë¦¬ì ê³„ì•½ì„œêµ­ë¬¸': 'íŒŒíŠ¸ë„ˆì‹­/ì œíœ´',
  'ë™ì—…ê³„ì•½ì„œ(ê°ìëŒ€í‘œ)': 'íŒŒíŠ¸ë„ˆì‹­/ì œíœ´',
  'ë™ì—…ê³„ì•½ì„œ(í˜¼ìëŒ€í‘œ)': 'íŒŒíŠ¸ë„ˆì‹­/ì œíœ´',
  'ë””ìì¸ ì„œë¹„ìŠ¤ ê³„ì•½ì„œêµ­ë¬¸': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ë””ìì¸ì—…ì¢…(ì œí’ˆ ì‹œê° í¬ì¥) í‘œì¤€í•˜ë„ê¸‰ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ë””ì§€í„¸ì½˜í…ì¸ (ìŒì•…)ê³µê¸‰ í‘œì¤€ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ë§¤ì¥ì„ëŒ€ì°¨í‘œì¤€ê³„ì•½ì„œ(ì•„ìš¸ë › ë³µí•©ì‡¼í•‘ëª°)': 'ê±°ë˜/êµ¬ë§¤',
  'ëª¨ë¸(ë¯¸ìˆ ì‚¬ì§„ì‘í’ˆ)ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ë¬¼í’ˆêµ¬ë§¤ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ë¯¸ìˆ ì‚¬ì§„ì‘í’ˆ ì „ì‹œ(ì˜¨ë¼ì¸ì „ì‹œë¶€ì†í•©ì˜í¬í•¨)ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ë¯¼ê°„ê±´ì„¤ê³µì‚¬ í‘œì¤€ë„ê¸‰ê³„ì•½ì„œ': 'ì œì¡°/ê³µê¸‰',
  'ë°©ì—¼ì²˜ë¦¬ í‘œì¤€ë„ê¸‰ê³„ì•½ì„œ': 'ì œì¡°/ê³µê¸‰',
  'ë²•ë¥ ìë¬¸ê³„ì•½ì„œ(ê°„ë‹¨)': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ë²•ë¥ ìë¬¸ê³„ì•½ì„œ(ìƒì„¸)': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ë³´ì•ˆì„œì•½ì„œ(í”„ë¡œì íŠ¸ì°¸ì—¬ììš©)': 'ë¹„ë°€/ë³´ì•ˆ',
  'ë¶€ë™ì‚° ë§¤ë§¤ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ë¶€ë™ì‚°ê·¼ì €ë‹¹ê¶Œì„¤ì •ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ë¶€ë™ì‚°ì„ëŒ€ì°¨ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ë¶ˆìš©ë¬¼í’ˆ(ì°¨ëŸ‰) ë§¤ê°ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ë¹„ë°€ìœ ì§€ê³„ì•½ì„œ': 'ë¹„ë°€/ë³´ì•ˆ',
  'ìƒí‘œê¶Œ ì–‘ë„ í‘œì¤€ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ìƒí™œìš©í’ˆì—…ì¢… í‘œì¤€ëŒ€ë¦¬ì ê³„ì•½ì„œ': 'íŒŒíŠ¸ë„ˆì‹­/ì œíœ´',
  'ì„ ë°•ì„ëŒ€ì°¨ê³„ì•½ì„œ(ê±´ì„¤ì—…ì²´ìš©)': 'ê±°ë˜/êµ¬ë§¤',
  'ì„±ì‹¤ì‹œê³µ(ê³µê³µ ê³µì‚¬) ì´í–‰ê°ì„œ': 'ê¸°íƒ€/ì¼ë°˜',
  'ì„¸ë¬´ëŒ€ë¦¬ê³„ì•½ì„œêµ­ë¬¸': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ì†Œëª¨í’ˆ êµ¬ë§¤ì¡°ê±´ë¶€ ì¥ë¹„(ì˜ë£Œì¥ë¹„) ì„ëŒ€ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì†Œë°©ì‹œì„¤ê³µì‚¬ì—…ì¢… í‘œì¤€í•˜ë„ê¸‰ ê¸°ë³¸ê³„ì•½ì„œ': 'ì œì¡°/ê³µê¸‰',
  'ì†Œë°©ì‹œì„¤ì„¤ê³„ í‘œì¤€ë„ê¸‰ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ì†Œí”„íŠ¸ì›¨ì–´ ë¼ì´ì„ ìŠ¤ ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì†Œí”„íŠ¸ì›¨ì–´ì‚¬ì—…í‘œì¤€í•˜ë„ê¸‰ê³„ì•½ì„œêµ­ë¬¸': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ìˆ˜ì¶œë¬¼í’ˆ ì„ê°€ê³µê³„ì•½ì„œ': 'ì œì¡°/ê³µê¸‰',
  'ìŠ¹ê°•ê¸°ì„¤ì¹˜ê³µì‚¬ì—…ì¢… í‘œì¤€í•˜ë„ê¸‰ê³„ì•½ì„œ': 'ì œì¡°/ê³µê¸‰',
  'ì‹œì„¤ê³µì‚¬ ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ì‹ìŒë£Œì—…ì¢…ëŒ€ë¦¬ì í‘œì¤€ê³„ì•½ì„œ': 'íŒŒíŠ¸ë„ˆì‹­/ì œíœ´',
  'ì•½ì†ì´í–‰ê°ì„œ(ë¶€ë™ì‚°ë§¤ë§¤ëŒ€ê¸ˆ)': 'ê¸°íƒ€/ì¼ë°˜',
  'ì—…ë¬´ì œíœ´ í˜‘ì•½ì„œ': 'íŒŒíŠ¸ë„ˆì‹­/ì œíœ´',
  'ì—…ë¬´í˜‘ì•½ ì–‘í•´ê°ì„œ': 'íŒŒíŠ¸ë„ˆì‹­/ì œíœ´',
  'ì˜ìˆ˜ì¦ ì–‘ì‹ì°¨ìš©ê¸ˆì „ë¶€ë³€ì œ': 'ê¸°íƒ€/ì¼ë°˜',
  'ì˜ìˆ˜ì¦ì–‘ì‹ì°¨ìš©ê¸ˆì¼ë¶€ë³€ì œ': 'ê¸°íƒ€/ì¼ë°˜',
  'ì˜í™”ì‚°ì—… ê·¼ë¡œí‘œì¤€ê³„ì•½ì„œ': 'ê·¼ë¡œ/ê³ ìš©',
  'ì˜¤ë””ì˜¤ë¶ ë°°íƒ€ì ë°œí–‰ê¶Œ ì„¤ì •ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì˜¤ë””ì˜¤ë¶ ìœ í†µ ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì˜¤ë””ì˜¤ë¶ ì €ì‘ì¸ì ‘ê¶Œ ì´ìš©í—ˆë½ ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì˜¤ë””ì˜¤ë¶ ì œì‘ ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ì˜¨ë¼ì¸ ê´‘ê³  ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ì˜¨ë¼ì¸ì‡¼í•‘ëª°í‘œì¤€ê±°ë˜ê³„ì•½ì„œ(ìœ„ìˆ˜íƒê±°ë˜)': 'ê±°ë˜/êµ¬ë§¤',
  'ì™¸êµ­ì¸í‘œì¤€ê·¼ë¡œê³„ì•½ì„œ': 'ê·¼ë¡œ/ê³ ìš©',
  'ì›¹ì‚¬ì´íŠ¸ ì œì‘ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ì›¹íˆ° ì—°ì¬ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ìœ„ì„ê³„ì•½ì„œ(ê°„ë‹¨ì„œì‹)': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ìœ„ì„ì¥(ê°„ë‹¨ì„œì‹)': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ìœ„íƒê°€ê³µê³„ì•½ì„œêµ­ë¬¸': 'ì œì¡°/ê³µê¸‰',
  'ìœ ì§€ë³´ìˆ˜ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ì˜ë¥˜ì—…ì¢…ëŒ€ë¦¬ì (ì¬íŒë§¤í˜•)í‘œì¤€ê³„ì•½ì„œ': 'íŒŒíŠ¸ë„ˆì‹­/ì œíœ´',
  'ì´ëŸ¬ë‹ì½˜í…ì¸  ê°œë°œìš©ì—­ í‘œì¤€ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ì´ì‚¬ìš©ì—­ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ì´í–‰ê°ì„œ(ì±„ë¬´ë³€ì œ)': 'ê¸°íƒ€/ì¼ë°˜',
  'ì¸í…Œë¦¬ì–´ê³µì‚¬ í‘œì¤€ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ì €ì‘ë¬¼ ì´ìš©ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì €ì‘ì¬ì‚°ê¶Œ ë…ì ì  ì´ìš©í—ˆë½ ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì €ì‘ì¬ì‚°ê¶Œ ë¹„ë…ì ì  ì´ìš©í—ˆë½ ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì €ì‘ì¬ì‚°ê¶Œ ì–‘ë„ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì €ì‘ì¬ì‚°ê¶Œ ì¼ë¶€ì— ëŒ€í•œ ì–‘ë„ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì „ê¸°ê³µì‚¬í‘œì¤€ë„ê¸‰ê³„ì•½ì„œ': 'ì œì¡°/ê³µê¸‰',
  'ì „ìì¶œíŒ ë°°íƒ€ì ë°œí–‰ê¶Œ ë° ì¶œíŒê¶Œ ì„¤ì •ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì „ìì¶œíŒ ë°°íƒ€ì ë°œí–‰ê¶Œ ì„¤ì •ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì •ë³´í†µì‹ ê³µì‚¬í‘œì¤€ë„ê¸‰ê³„ì•½ì„œ': 'ì œì¡°/ê³µê¸‰',
  'ì •ìˆ˜ê¸° ì„ëŒ€ì°¨(ë Œíƒˆ) ì•½ê´€ ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì œì•½ì—…ì¢…ëŒ€ë¦¬ì í‘œì¤€ê³„ì•½ì„œ': 'íŒŒíŠ¸ë„ˆì‹­/ì œíœ´',
  'ì£¼ì‹ ì–‘ìˆ˜ë„ ê³„ì•½ì„œ(ê°œì¸ê°„)': 'ê±°ë˜/êµ¬ë§¤',
  'ì§‘ë‹¨ê¸‰ì‹ì†Œìœ„íƒìš´ì˜ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'ì´íŒëŒ€ë¦¬ì ê³„ì•½ì„œ': 'íŒŒíŠ¸ë„ˆì‹­/ì œíœ´',
  'ì¶œíŒê¶Œ ì„¤ì •(ë„ì„œì¶œê°„)ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì»¤ë¯¸ì…˜(ì•Œì„ ì¤‘ê°œìˆ˜ìˆ˜ë£Œ)ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì»¤ë¯¸ì…˜(íŒë§¤ìˆ˜ìˆ˜ë£Œ) ì§€ê¸‰ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'ì»¨ì„¤íŒ…ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'íˆ¬ìê³„ì•½ì„œ(ë³´í†µì£¼ ë°©ì‹)': 'íˆ¬ì/ìê¸ˆ',
  'íŠ¹í—ˆ ë° ê¸°ìˆ ë„ì…ê³„ì•½ì„œêµ­ë¬¸': 'ê±°ë˜/êµ¬ë§¤',
  'íŠ¹í—ˆê¶Œ ì–‘ë„ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'í‘œì¤€ ëŒ€ì¶œëª¨ì§‘ì—…ë¬´ ìœ„íƒê³„ì•½ì„œ(ê¸ˆìœµì‚¬ ëŒ€ì¶œëª¨ì§‘ë²•ì¸ê°„)': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'í‘œì¤€ ëŒ€ì¶œëª¨ì§‘ì—…ë¬´ ìœ„íƒê³„ì•½ì„œ(ê¸ˆìœµì‚¬ ëŒ€ì¶œìƒë‹´ì‚¬ê°„)': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'í‘œì¤€ ëŒ€ì¶œëª¨ì§‘ì—…ë¬´ ìœ„íƒê³„ì•½ì„œ(ëŒ€ì¶œëª¨ì§‘ë²•ì¸ ëŒ€ì¶œìƒë‹´ì‚¬ê°„)': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'í‘œì¤€ê´‘ê³ ì¶œì—°ê³„ì•½ì„œêµ­ë¬¸': 'ê·¼ë¡œ/ê³ ìš©',
  'í‘œì¤€ê·¼ë¡œê³„ì•½ì„œ(ê±´ì„¤ì¼ìš©ì§)': 'ê·¼ë¡œ/ê³ ìš©',
  'í‘œì¤€ê·¼ë¡œê³„ì•½ì„œ(ê¸°ê°„ì •í•¨ì—†ìŒ)': 'ê·¼ë¡œ/ê³ ìš©',
  'í‘œì¤€ê·¼ë¡œê³„ì•½ì„œ(ê¸°ê°„ì •í•¨ìˆìŒ)': 'ê·¼ë¡œ/ê³ ìš©',
  'í‘œì¤€ê·¼ë¡œê³„ì•½ì„œ(ë‹¨ì‹œê°„ê·¼ë¡œì)': 'ê·¼ë¡œ/ê³ ìš©',
  'í‘œì¤€ê·¼ë¡œê³„ì•½ì„œ(ë¯¸ì„±ë…„ì)': 'ê·¼ë¡œ/ê³ ìš©',
  'í‘œì¤€ë¬¼í’ˆë§¤ë§¤ê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'í”„ëœì°¨ì´ì¦ˆ(ìë™ì°¨ì •ë¹„ê°€ë§¹ì ) í‘œì¤€ê³„ì•½ì„œ': 'íŒŒíŠ¸ë„ˆì‹­/ì œíœ´',
  'í”„ëœì°¨ì´ì¦ˆ(ì»¤í”¼ê°€ë§¹ì )í‘œì¤€ê³„ì•½ì„œ': 'íŒŒíŠ¸ë„ˆì‹­/ì œíœ´',
  'í”„ë¦¬ëœì„œ ìš©ì—­ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'í™”ê°€(ì‚¬ì§„)ì‘ê°€ ì „ì†ê³„ì•½ì„œ': 'ìš©ì—­/í”„ë¡œì íŠ¸',
  'í™”ë¬¼ìë™ì°¨ ìš´ì†¡ì‚¬ì—… í‘œì¤€ìœ„ìˆ˜íƒê³„ì•½ì„œ': 'ê±°ë˜/êµ¬ë§¤',
  'í™”ì¥í’ˆëŒ€ë¦¬ì í‘œì¤€ê³„ì•½ì„œ': 'íŒŒíŠ¸ë„ˆì‹­/ì œíœ´'
};

// ì„¤ì •
const CONFIG = {
  baseUrl: 'http://localhost:3100',
  contractsDir: './contract_txt',
  delayBetweenUploads: 3000, // 3ì´ˆ ë”œë ˆì´ (AI ë¶„ì„ ì‹œê°„ ê³ ë ¤)
  maxRetries: 3
};

/**
 * ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜
 */
async function main() {
  console.log('ğŸš€ ëŒ€ëŸ‰ í…œí”Œë¦¿ ì—…ë¡œë“œ ì‹œì‘...');
  console.log(`ğŸ“ ê³„ì•½ì„œ í´ë”: ${CONFIG.contractsDir}`);
  console.log(`ğŸ¯ ì„œë²„ ì£¼ì†Œ: ${CONFIG.baseUrl}`);
  
  // í† í° í™•ì¸
  const token = getTokenFromArgs();
  if (!token) {
    console.error('âŒ í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤.');
    console.log('ì‚¬ìš©ë²•: node scripts/bulkUploadTemplates.js --token=YOUR_TOKEN');
    console.log('');
    console.log('í† í° í™•ì¸ ë°©ë²•:');
    console.log('1. ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:3100/login ì ‘ì†');
    console.log('2. ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸');
    console.log('3. ê°œë°œìë„êµ¬(F12) > Application > Local Storage > token ê°’ ë³µì‚¬');
    process.exit(1);
  }
  
  // ê³„ì•½ì„œ í´ë” í™•ì¸
  if (!fs.existsSync(CONFIG.contractsDir)) {
    console.error(`âŒ ê³„ì•½ì„œ í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${CONFIG.contractsDir}`);
    process.exit(1);
  }
  
  // txt íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
  const txtFiles = fs.readdirSync(CONFIG.contractsDir)
    .filter(file => file.endsWith('.txt'))
    .sort();
  
  if (txtFiles.length === 0) {
    console.error('âŒ txt íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
    process.exit(1);
  }
  
  console.log(`ğŸ“„ ë°œê²¬ëœ ê³„ì•½ì„œ íŒŒì¼: ${txtFiles.length}ê°œ`);
  
  // ë§¤í•‘ë˜ì§€ ì•Šì€ íŒŒì¼ í™•ì¸
  const unmappedFiles = txtFiles.filter(file => {
    const nameWithoutExt = file.replace('.txt', '');
    return !TEMPLATE_MAPPING[nameWithoutExt];
  });
  
  if (unmappedFiles.length > 0) {
    console.warn('âš ï¸ ë§¤í•‘ë˜ì§€ ì•Šì€ íŒŒì¼ë“¤:');
    unmappedFiles.forEach(file => console.warn(`   - ${file}`));
    console.log('');
  }
  
  // ë§¤í•‘ëœ íŒŒì¼ë§Œ ì²˜ë¦¬
  const mappedFiles = txtFiles.filter(file => {
    const nameWithoutExt = file.replace('.txt', '');
    return TEMPLATE_MAPPING[nameWithoutExt];
  });
  
  console.log(`âœ… ì—…ë¡œë“œ ëŒ€ìƒ íŒŒì¼: ${mappedFiles.length}ê°œ`);
  console.log(`â±ï¸ ì˜ˆìƒ ì†Œìš” ì‹œê°„: ${Math.ceil(mappedFiles.length * CONFIG.delayBetweenUploads / 1000 / 60)}ë¶„`);
  console.log('');
  
  // ì§„í–‰ë¥  ì¶”ì 
  let successCount = 0;
  let failCount = 0;
  let totalClauses = 0;
  
  // ìˆœì°¨ ì—…ë¡œë“œ
  for (let i = 0; i < mappedFiles.length; i++) {
    const file = mappedFiles[i];
    const nameWithoutExt = file.replace('.txt', '');
    const category = TEMPLATE_MAPPING[nameWithoutExt];
    const filePath = path.join(CONFIG.contractsDir, file);
    
    console.log(`\nğŸ“‹ [${i + 1}/${mappedFiles.length}] ${nameWithoutExt}`);
    console.log(`   ì¹´í…Œê³ ë¦¬: ${category}`);
    
    try {
      // íŒŒì¼ ì½ê¸°
      const content = fs.readFileSync(filePath, 'utf8');
      const fileSize = fs.statSync(filePath).size;
      
      console.log(`   íŒŒì¼ í¬ê¸°: ${formatBytes(fileSize)}`);
      console.log(`   ë‚´ìš© ê¸¸ì´: ${content.length.toLocaleString()}ì`);
      
      // ì—…ë¡œë“œ ì‹¤í–‰
      const result = await uploadTemplate({
        name: nameWithoutExt,
        category: category,
        content: content,
        token: token
      });
      
      if (result.success) {
        successCount++;
        totalClauses += result.extractedClauses || 0;
        
        console.log(`   âœ… ì—…ë¡œë“œ ì„±ê³µ`);
        console.log(`   ğŸ” ì¶”ì¶œëœ ì¡°í•­: ${result.extractedClauses || 0}ê°œ`);
        
        if (result.analysis) {
          console.log(`   ğŸ“Š ë¶„ì„ ì™„ë£Œ: ${result.analysis.clauseCount}ê°œ ì¡°í•­ ë¶„ì„ë¨`);
        }
      } else {
        failCount++;
        console.log(`   âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ${result.error}`);
      }
      
    } catch (error) {
      failCount++;
      console.log(`   âŒ íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜: ${error.message}`);
    }
    
    // ì§„í–‰ë¥  í‘œì‹œ
    const progress = Math.round(((i + 1) / mappedFiles.length) * 100);
    console.log(`   ğŸ“ˆ ì§„í–‰ë¥ : ${progress}% (ì„±ê³µ: ${successCount}, ì‹¤íŒ¨: ${failCount})`);
    
    // ë‹¤ìŒ íŒŒì¼ ì „ ëŒ€ê¸° (ë§ˆì§€ë§‰ íŒŒì¼ ì œì™¸)
    if (i < mappedFiles.length - 1) {
      console.log(`   â³ ${CONFIG.delayBetweenUploads / 1000}ì´ˆ ëŒ€ê¸° ì¤‘... (AI ë¶„ì„ ì‹œê°„)`);
      await sleep(CONFIG.delayBetweenUploads);
    }
  }
  
  // ìµœì¢… ê²°ê³¼
  console.log('\nğŸ‰ ëŒ€ëŸ‰ ì—…ë¡œë“œ ì™„ë£Œ!');
  console.log('==========================================');
  console.log(`ğŸ“Š ì´ íŒŒì¼: ${mappedFiles.length}ê°œ`);
  console.log(`âœ… ì„±ê³µ: ${successCount}ê°œ`);
  console.log(`âŒ ì‹¤íŒ¨: ${failCount}ê°œ`);
  console.log(`ğŸ·ï¸ ì´ ì¶”ì¶œëœ ì¡°í•­: ${totalClauses.toLocaleString()}ê°œ`);
  console.log(`ğŸ“ˆ ì„±ê³µë¥ : ${Math.round((successCount / mappedFiles.length) * 100)}%`);
  
  if (totalClauses > 0) {
    console.log('');
    console.log('ğŸ” ì¡°í•­ ê²€í†  ì•ˆë‚´:');
    console.log('1. ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:3100/admin/clauses ì ‘ì†');
    console.log('2. ê²€í†  ëŒ€ê¸° ì¡°í•­ë“¤ì„ í™•ì¸í•˜ê³  ìŠ¹ì¸/ê±°ë¶€ ì²˜ë¦¬');
    console.log(`3. ì˜ˆìƒ ê²€í†  ëŒ€ê¸° ì¡°í•­: ì•½ ${Math.round(totalClauses * 0.3)}ê°œ (ì‹ ë¢°ë„ 85% ë¯¸ë§Œ)`);
  }
  
  if (failCount > 0) {
    console.log('\nâš ï¸ ì‹¤íŒ¨í•œ íŒŒì¼ë“¤ì„ ë‹¤ì‹œ í™•ì¸í•´ë³´ì„¸ìš”.');
  }
}

/**
 * ê°œë³„ í…œí”Œë¦¿ ì—…ë¡œë“œ
 */
async function uploadTemplate({ name, category, content, token }) {
  for (let attempt = 1; attempt <= CONFIG.maxRetries; attempt++) {
    try {
      const response = await axios.post(`${CONFIG.baseUrl}/api/admin/templates`, {
        name: name,
        category: category,
        content: content,
        description: `${name} í…œí”Œë¦¿ (ìë™ ì—…ë¡œë“œ)`
      }, {
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        }
      });
      
      const result = response.data;
      
      return {
        success: true,
        extractedClauses: result.extractedClauses || 0,
        analysis: result.analysis,
        message: result.message
      };
      
    } catch (error) {
      const errorMsg = error.response?.data?.error || error.message;
      console.log(`   âš ï¸ ì‹œë„ ${attempt}/${CONFIG.maxRetries} ì‹¤íŒ¨: ${errorMsg}`);
      
      if (attempt === CONFIG.maxRetries) {
        return {
          success: false,
          error: errorMsg
        };
      }
      
      // ì¬ì‹œë„ ì „ ì§§ì€ ëŒ€ê¸°
      await sleep(1000);
    }
  }
}

/**
 * ëª…ë ¹í–‰ ì¸ìˆ˜ì—ì„œ í† í° ì¶”ì¶œ
 */
function getTokenFromArgs() {
  const args = process.argv.slice(2);
  const tokenArg = args.find(arg => arg.startsWith('--token='));
  
  if (tokenArg) {
    return tokenArg.split('=')[1];
  }
  
  return null;
}

/**
 * íŒŒì¼ í¬ê¸° í¬ë§·íŒ…
 */
function formatBytes(bytes, decimals = 2) {
  if (bytes === 0) return '0 Bytes';
  
  const k = 1024;
  const dm = decimals < 0 ? 0 : decimals;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  
  return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
}

/**
 * ëŒ€ê¸° í•¨ìˆ˜
 */
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

/**
 * ì—ëŸ¬ í•¸ë“¤ë§
 */
process.on('unhandledRejection', (reason, promise) => {
  console.error('ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€:', reason);
  process.exit(1);
});

process.on('uncaughtException', (error) => {
  console.error('ì²˜ë¦¬ë˜ì§€ ì•Šì€ ì˜ˆì™¸:', error);
  process.exit(1);
});

// ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
if (require.main === module) {
  main().catch(error => {
    console.error('âŒ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì˜¤ë¥˜:', error);
    process.exit(1);
  });
}